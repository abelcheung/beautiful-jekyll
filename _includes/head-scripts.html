{% comment %}
Migrating from manual script calling to Require.JS since June 2019
{% endcomment %}
{%- assign rjsmods = site.requirejs.mods -%}
{%- if layout.requirejs -%}{%- assign rjsmods = rjsmods | concat: layout.requirejs.mods -%}{%- endif -%}
{%- if page.requirejs -%}{%- assign rjsmods = rjsmods | concat: page.requirejs.mods -%}{%- endif -%}
{%- if rjsmods -%}
<!-- Require.JS -->
<script>
var require = {
	deps: ['
	{{- rjsmods | compact | uniq | join: "','" -}}
	'],
	baseUrl: '{{ "assets/js" | relative_url }}',
	shim: {
		bootstrap: { deps: ['jquery'] }
	},
	onNodeCreated: function(node, config, module, path) {
		var sri;
		sri = {
			{% for lib in site.requirejs.libs %}
			{%- if lib.sri -%}
			{{ lib.name }} : '{{ lib.sri }}',
			{% endif %}
			{%- endfor -%}
		};
		if (sri[module]) {
			node.setAttribute('integrity', sri[module]);
			node.setAttribute('crossorigin', 'anonymous');
		}
	},
	paths: {
		{% for lib in site.requirejs.libs %}
		{%- if lib.sri -%}
		{{ lib.name }} : '{{ lib.href }}',
		{% endif %}
		{%- endfor -%}
	}
};
</script>
<script async src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.js" integrity="sha384-WKPjHIEhBzyEuCp8//j0gXBM/TP1OwKdWMPBRFZ6q8g66Pce1n6o0M/q4duEXrmA" crossorigin="anonymous"></script>
<!-- End Require.JS -->
{%- endif -%}
